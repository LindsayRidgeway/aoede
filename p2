// Updated function to get constants with better support for env variables
const getConstantValue = (key) => {
  // Explicitly log all attempted paths for debugging
  if (DEBUG_KEYS) {
    console.log(`[API] Looking for ${key} in all possible locations...`);
    console.log(`[API] Constants.extra exists: ${!!Constants?.extra}`);
    console.log(`[API] Constants.expoConfig exists: ${!!Constants?.expoConfig}`);
    console.log(`[API] Constants.expoConfig.extra exists: ${!!Constants?.expoConfig?.extra}`);
    console.log(`[API] Constants.manifest exists: ${!!Constants?.manifest}`);
    console.log(`[API] Constants.manifest.extra exists: ${!!Constants?.manifest?.extra}`);
    
    // Log values for full transparency
    if (Constants?.extra && Constants.extra[key] !== undefined) {
      console.log(`[API] Found ${key} in Constants.extra: "${Constants.extra[key]}"`);
    }
    if (Constants?.expoConfig?.extra && Constants.expoConfig.extra[key] !== undefined) {
      console.log(`[API] Found ${key} in Constants.expoConfig.extra: "${Constants.expoConfig.extra[key]}"`);
    }
    if (Constants?.manifest?.extra && Constants.manifest.extra[key] !== undefined) {
      console.log(`[API] Found ${key} in Constants.manifest.extra: "${Constants.manifest.extra[key]}"`);
    }
    if (Constants && Constants[key] !== undefined) {
      console.log(`[API] Found ${key} directly in Constants: "${Constants[key]}"`);
    }
    if (typeof process !== 'undefined' && process.env && process.env[key] !== undefined) {
      console.log(`[API] Found ${key} in process.env: "${process.env[key]}"`);
    }
  }
  
  let value = null;
  
  // First try to get value directly from Constants.extra
  if (Constants?.extra && Constants.extra[key] !== undefined) {
    if (DEBUG_KEYS) console.log(`[API] Using ${key} from Constants.extra`);
    value = Constants.extra[key];
  }
  
  // Try the new path (expoConfig.extra) - Expo SDK 46+
  else if (Constants?.expoConfig?.extra && Constants.expoConfig.extra[key] !== undefined) {
    if (DEBUG_KEYS) console.log(`[API] Using ${key} from Constants.expoConfig.extra`);
    value = Constants.expoConfig.extra[key];
  }
  
  // Fallback to old path (manifest.extra) - before Expo SDK 46
  else if (Constants?.manifest?.extra && Constants.manifest.extra[key] !== undefined) {
    if (DEBUG_KEYS) console.log(`[API] Using ${key} from Constants.manifest.extra`);
    value = Constants.manifest.extra[key];
  }
  
  // For Expo Go and some environments - check at top level
  else if (Constants && Constants[key] !== undefined) {
    if (DEBUG_KEYS) console.log(`[API] Using ${key} directly from Constants`);
    value = Constants[key];
  }
  
  // Try to get from process.env directly as final fallback
  else if (typeof process !== 'undefined' && process.env && process.env[key] !== undefined) {
    if (DEBUG_KEYS) console.log(`[API] Using ${key} from process.env as LAST RESORT`);
    value = process.env[key];
  }
  
  // If we still don't have a value, log and return null
  if (!value && DEBUG_KEYS) {
    console.log(`[API] FAILED to find ${key} in any location`);
    return null;
  }
  
  // Log detailed info about the key
  if (DEBUG_KEYS) {
    logKeyDetails(key, value);
  }
  
  return value;
};